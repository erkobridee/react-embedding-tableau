import{j as e,a as n,F as te}from"./index-0997910d.js";import{c as S,r as l}from"./vendor-8535c4d4.js";import{s as ne}from"./slugify-7e606d19.js";import{u as se,T as le,P as re,a as oe}from"./PublicTableauInfoFooter-defeaea7.js";import{B as M}from"./Button-ec77a92e.js";import{a as ce,I as ie}from"./InputRangeField-dbe4b9eb.js";import"./index-c8708f0b.js";import"./RoutesContent-eb4d1024.js";import"./TailwindTypography-faec97d0.js";const I="block px-3 py-2 leading-tight border",j=S(I,"text-gray-500 bg-white border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"),de=S(j,"ml-0 rounded-l-lg"),ue=S(j,"ml-0 rounded-r-lg"),T=S(I,"text-gray-500 bg-white border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"),ge=S(I,"z-10 text-blue-600 border-blue-300 bg-blue-50 hover:bg-blue-100 hover:text-blue-700 dark:border-gray-700 dark:bg-gray-700 dark:text-white"),me=()=>e("nav",{"aria-label":"data navigation",className:"flex items-center",children:n("ul",{className:"inline-flex items-center -space-x-px",children:[e("li",{children:n("button",{className:de,children:[e("span",{className:"sr-only",children:"Previous"}),e("svg",{"aria-hidden":"true",className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})]})}),e("li",{children:e("button",{className:T,children:"1"})}),e("li",{children:e("button",{className:T,children:"2"})}),e("li",{children:e("button",{"aria-current":"page",className:ge,children:"3"})}),e("li",{children:e("button",{className:T,children:"4"})}),e("li",{children:e("button",{className:T,children:"5"})}),e("li",{children:n("button",{className:ue,children:[e("span",{className:"sr-only",children:"Next"}),e("svg",{"aria-hidden":"true",className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})]})})]})}),he=({disabled:d=!1,page:u=0,pagesCount:o,maxButtons:r=10,onPageChange:h=()=>{}})=>{const[b,f]=l.useState(u+1);se(()=>{f(u+1)},[u]);const y=c=>h(c);return n("div",{className:"flex gap-4 items-center",children:[e("span",{children:"TODO: finish the implementation"}),e(me,{disabled:d,page:u,pagesCount:o,maxButtons:r,onPageChange:c=>{f(c),y(c)}}),n("div",{className:"flex gap-2 items-center",children:[e("span",{className:"font-bold",children:"Page:"}),e(ce,{className:"min-w-[5rem] py-1",type:"number",max:o,min:1,step:1,value:b,onChange:c=>{const{valueAsNumber:g}=c.currentTarget;f(g)},onBlur:c=>{const{valueAsNumber:g}=c.target,x=g<1?1:g>o?o:g;f(x),y(x-1)}}),e("span",{children:`/ ${o}`})]})]})},F="https://public.tableau.com/views/RegionalSampleWorkbook/Storms",i={ACTIVE:"active",DISABLED:"disabled",PROCESSING:"processing"},v={min:50,max:1e3},R=50,pe="w-36",be=d=>ne(d,{lower:!0,remove:/[*+~.()'"!:@]/g}),fe=d=>{const u=d.columns.map(({fieldName:r,dataType:h})=>({fieldId:be(r),fieldName:r,dataType:h}));return d.data.map(r=>u.map((h,b)=>({...h,value:r[b].nativeValue})))},Ne=()=>{const d=l.useRef(),u=l.useRef(null),[o,r]=l.useState(i.DISABLED),[h,b]=l.useState(R),[f,y]=l.useState(R),D=l.useRef(R),E=async t=>{const a=t!==oe.READY?i.DISABLED:i.ACTIVE;if(r(a),a===i.ACTIVE){const s=u.current;if(!s)return;const m=s.workbook.activeSheet.worksheets.find(N=>N.name==="Storm Map Sheet");d.current=m}},L=t=>{const{valueAsNumber:a}=t.currentTarget;b(a)},c=t=>{const{valueAsNumber:a}=t.target,s=a<v.min?v.min:a>v.max?v.max:a;b(s),y(s),D.current=s},[g,x]=l.useState({caption:"",id:""}),[k,B]=l.useState(0),[z,_]=l.useState(0),[w,V]=l.useState([]),[W,Y]=l.useState(0),C=l.useRef(),q=async()=>{if(C.current)return C.current;const t=d.current;if(!t)return;const a=await t.getDataSourcesAsync(),s=await a[0].getLogicalTablesAsync();s.forEach(function(G){console.log(`Name of logical table: ${G.caption}`),console.log(`ID of logical table: ${G.id}`)});const p=s[0],{id:m,caption:N}=p;x({caption:N,id:m});const U=await a[0].getLogicalTableDataAsync(m);console.log({logicalTableData:U});const $=U.totalRowCount;console.log(`Total rows count: ${$}`),Y($);const P=await a[0].getLogicalTableDataReaderAsync(m,D.current);console.log({pageReader:P}),C.current=P;const H=P.pageCount;return console.log(`Total pages count: ${H}`),_(H),P},O=async(t=0)=>{r(i.PROCESSING);const a=await q();if(!a)return;const s=await a.getPageAsync(t),p=fe(s);V(p),B(t),console.log("readPageData ",{pageNumber:t,parsedData:p}),setTimeout(()=>{r(i.ACTIVE)},100)},J=t=>async a=>{t!==a&&await O(a)},K=async()=>{var t;r(i.PROCESSING),await((t=C.current)==null?void 0:t.releaseAsync()),V([]),_(0),B(0),C.current=void 0,x({caption:"",id:""}),setTimeout(()=>{r(i.ACTIVE)},100)},Q=async()=>{await O()},A=o!==i.ACTIVE,X=A||w.length>0,Z=A||w.length===0,ee=w.length>0&&o===i.PROCESSING,ae=w.length>0;return n("div",{className:"flex flex-col items-center w-full space-y-3",children:[n("div",{className:"flex gap-3 items-center",children:[e("span",{className:"font-bold",children:"ui status:"})," ",e("span",{children:o})]}),n("div",{className:"flex flex-col gap-3 items-center",children:[e(ie,{label:"Items per page",className:pe,min:v.min,max:v.max,step:100,disabled:A,value:h,onChange:L,onBlur:c}),n("div",{className:"flex gap-3 items-center",children:[e(M,{disabled:X,onClick:Q,children:"Get Data"}),e(M,{disabled:Z,onClick:K,children:"Clear Data"})]})]}),e("div",{className:"flex justify-center h-[630px] min-w-[800px]",children:e(le,{ref:u,viewUrl:F,onStatusChange:E})}),e(re,{tableauUrl:F,label:"Get Logical Data",url:"https://tableau.github.io/embedding-api-v3-samples/getDataTableReader.html",code:"https://github.com/tableau/embedding-api-v3-samples/blob/main/getDataTableReader.html"}),ae?n(te,{children:[e("hr",{className:"border-divider my-4 sm:mx-auto lg:my-6 w-full"}),e("div",{className:"flex gap-3 items-center",children:n("div",{className:"flex gap-1 items-center",children:[e("span",{className:"font-bold",children:"Logical table:"}),e("span",{className:"italic",children:`id: ${g.id} | caption: ${g.caption}`})]})}),n("div",{className:"flex gap-3 items-center",children:[n("div",{className:"flex gap-1 items-center",children:[e("span",{className:"font-bold",children:"Items per page:"}),e("span",{className:"italic",children:f})]}),n("div",{className:"flex gap-1 items-center",children:[e("span",{className:"font-bold",children:"Total items count:"}),e("span",{className:"italic",children:W})]})]}),e(he,{page:k,pagesCount:z,onPageChange:J(k),disabled:ee}),n("div",{className:"flex gap-3 items-center justify-center flex-wrap max-h-[30rem] overflow-auto relative",children:[e("div",{className:"sticky top-0 left-0 right-0 h-5 w-full bg-gradient-to-b from-[var(--color-bg-app)] to-transparent"}),w.map((t,a)=>e("div",{className:"p-2 flex flex-col space-y-2 border rounded-md",children:t.map(({fieldId:s,fieldName:p,value:m,dataType:N})=>n("div",{className:"flex gap-3",children:[e("span",{className:"font-bold",children:`${p}:`}),e("span",{children:N==="date-time"?`${new Date(`${m}`).toISOString()}`:`${m}`}),e("span",{children:`( ${N} )`})]},s))},a)),e("div",{className:"sticky bottom-0 left-0 right-0 h-5 w-full bg-gradient-to-b from-transparent to-[var(--color-bg-app)]"})]})]}):null]})},Ae=Ne;export{Ne as PublicGetLogicalDataExample,Ae as default};

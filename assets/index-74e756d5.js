import{j as e,a as r,F as se}from"./index-910d83b1.js";import{c as R,r as u}from"./vendor-8535c4d4.js";import{s as ne}from"./slugify-7e606d19.js";import{u as le,T as re,P as oe,a as ce}from"./PublicTableauInfoFooter-456301ab.js";import{B as M}from"./Button-3845cdaa.js";import{a as ie,I as de}from"./InputRangeField-6dc49cbc.js";import{b as E}from"./buildNumbersRangeArray-48c469db.js";import"./index-8baea871.js";import"./RoutesContent-09c9f682.js";import"./TailwindTypography-fce19ff2.js";const j="outline-none transition-colors block px-3 py-2 leading-tight border",z=R(j,"disabled:pointer-events-none","bg-transparent border border-slate-200","dark:border-slate-700 dark:text-slate-100","dark:hover:text-slate-100"),L=R(z,"disabled:opacity-50","hover:bg-slate-100","dark:hover:bg-slate-800 dark:hover:text-slate-100 dark:hover:bg-slate-700","active:bg-slate-200 dark:active:bg-slate-700"),ue=R(L,"ml-0 rounded-l-lg"),me=R(L,"ml-0 rounded-r-lg"),ge=R(j,"z-10 text-blue-600 border-blue-300 bg-blue-50 hover:bg-blue-100 hover:text-blue-700 dark:border-gray-700 dark:bg-gray-700 dark:text-white"),pe=({disabled:i=!1,page:g=0,pagesCount:t,onPageChange:c=()=>{}})=>{const n=g+1,p=i||n===1,P=i||n===t,S=o=>()=>{c(o-1)},v=()=>e("button",{disabled:!0,className:z,children:"..."}),N=o=>e("button",{className:L,onClick:S(o),children:o}),m=o=>e("button",{disabled:!0,"aria-current":"page",className:ge,children:o}),b=()=>{const f=C=>C===n?m(C):N(C);if(t<=9)return E(1,t).map(f);const l=[];return n<=6?(l.push(...E(1,7).map(f)),l.push(v()),l.push(N(t)),l):n>=t-5?(l.push(N(1)),l.push(v()),l.push(...E(t-(9-3),t).map(f)),l):(l.push(N(1)),l.push(v()),l.push(...E(n-2,n+2).map(f)),l.push(v()),l.push(N(t)),l)};return e("nav",{"aria-label":"data navigation",className:"flex items-center",children:r("ul",{className:"inline-flex items-center -space-x-px",children:[e("li",{children:r("button",{className:ue,disabled:p,onClick:S(n-1),children:[e("span",{className:"sr-only",children:"Previous"}),e("svg",{"aria-hidden":"true",className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})]})}),b().map((o,f)=>e("li",{children:o},f)),e("li",{children:r("button",{className:me,disabled:P,onClick:S(n+1),children:[e("span",{className:"sr-only",children:"Next"}),e("svg",{"aria-hidden":"true",className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})]})})]})})},he=({disabled:i=!1,page:g=0,pagesCount:t,onPageChange:c=()=>{}})=>{const[n,p]=u.useState(g+1);le(()=>{p(g+1)},[g]);const P=m=>c(m);return r("div",{className:"flex gap-4 items-center",children:[e(pe,{disabled:i,page:g,pagesCount:t,onPageChange:m=>{p(m+1),P(m)}}),r("div",{className:"flex gap-2 items-center",children:[e("span",{className:"font-bold",children:"Page:"}),e(ie,{className:"min-w-[5rem] py-1",type:"number",max:t,min:1,step:1,value:n,onChange:m=>{const{valueAsNumber:b}=m.currentTarget;p(b)},onBlur:m=>{const{valueAsNumber:b}=m.target,o=b<1?1:b>t?t:b;p(o),P(o-1)},disabled:i}),e("span",{children:`/ ${t}`})]})]})},F="https://public.tableau.com/views/RegionalSampleWorkbook/Storms",h={ACTIVE:"active",DISABLED:"disabled",PROCESSING:"processing"},D={min:50,max:1e3},k=50,be="w-36",fe=i=>ne(i,{lower:!0,remove:/[*+~.()'"!:@]/g}),ve=i=>{const g=i.columns.map(({fieldName:c,dataType:n})=>({fieldId:fe(c),fieldName:c,dataType:n}));return i.data.map(c=>g.map((n,p)=>({...n,value:c[p].nativeValue})))},Ne=()=>{const i=u.useRef(),g=u.useRef(null),[t,c]=u.useState(h.DISABLED),[n,p]=u.useState(k),[P,S]=u.useState(k),v=u.useRef(k),N=async s=>{const a=s!==ce.READY?h.DISABLED:h.ACTIVE;if(c(a),a===h.ACTIVE){const d=g.current;if(!d)return;const x=d.workbook.activeSheet.worksheets.find(T=>T.name==="Storm Map Sheet");i.current=x}},m=s=>{const{valueAsNumber:a}=s.currentTarget;p(a)},b=s=>{const{valueAsNumber:a}=s.target,d=a<D.min?D.min:a>D.max?D.max:a;p(d),S(d),v.current=d},[o,f]=u.useState({caption:"",id:""}),[l,C]=u.useState(0),[W,V]=u.useState(0),[A,_]=u.useState([]),[Y,q]=u.useState(0),I=u.useRef(),J=async()=>{if(I.current)return I.current;const s=i.current;if(!s)return;const a=await s.getDataSourcesAsync(),d=await a[0].getLogicalTablesAsync();d.forEach(function(G){console.log(`Name of logical table: ${G.caption}`),console.log(`ID of logical table: ${G.id}`)});const w=d[0],{id:x,caption:T}=w;f({caption:T,id:x});const U=await a[0].getLogicalTableDataAsync(x);console.log({logicalTableData:U});const $=U.totalRowCount;console.log(`Total rows count: ${$}`),q($);const B=await a[0].getLogicalTableDataReaderAsync(x,v.current);console.log({pageReader:B}),I.current=B;const H=B.pageCount;return console.log(`Total pages count: ${H}`),V(H),B},O=async(s=0)=>{c(h.PROCESSING);const a=await J();if(!a)return;const d=await a.getPageAsync(s),w=ve(d);_(w),C(s),console.log("readPageData ",{pageNumber:s,parsedData:w}),setTimeout(()=>{c(h.ACTIVE)},100)},K=s=>async a=>{s!==a&&await O(a)},Q=async()=>{var s;c(h.PROCESSING),await((s=I.current)==null?void 0:s.releaseAsync()),_([]),V(0),C(0),I.current=void 0,f({caption:"",id:""}),setTimeout(()=>{c(h.ACTIVE)},100)},X=async()=>{await O()},y=t!==h.ACTIVE,Z=y||A.length>0,ee=y||A.length===0,ae=A.length>0&&t===h.PROCESSING,te=A.length>0;return r("div",{className:"flex flex-col items-center w-full space-y-3",children:[r("div",{className:"flex gap-3 items-center",children:[e("span",{className:"font-bold",children:"ui status:"})," ",e("span",{children:t})]}),r("div",{className:"flex flex-col gap-3 items-center",children:[e(de,{label:"Items per page",className:be,min:D.min,max:D.max,step:100,disabled:y,value:n,onChange:m,onBlur:b}),r("div",{className:"flex gap-3 items-center",children:[e(M,{disabled:Z,onClick:X,children:"Get Data"}),e(M,{disabled:ee,onClick:Q,children:"Clear Data"})]})]}),e("div",{className:"flex justify-center h-[630px] min-w-[800px]",children:e(re,{ref:g,viewUrl:F,onStatusChange:N})}),e(oe,{tableauUrl:F,label:"Get Logical Data",url:"https://tableau.github.io/embedding-api-v3-samples/getDataTableReader.html",code:"https://github.com/tableau/embedding-api-v3-samples/blob/main/getDataTableReader.html"}),te?r(se,{children:[e("hr",{className:"border-divider my-4 sm:mx-auto lg:my-6 w-full"}),e("div",{className:"flex gap-3 items-center",children:r("div",{className:"flex gap-1 items-center",children:[e("span",{className:"font-bold",children:"Logical table:"}),e("span",{className:"italic",children:`id: ${o.id} | caption: ${o.caption}`})]})}),r("div",{className:"flex gap-3 items-center",children:[r("div",{className:"flex gap-1 items-center",children:[e("span",{className:"font-bold",children:"Items per page:"}),e("span",{className:"italic",children:P})]}),r("div",{className:"flex gap-1 items-center",children:[e("span",{className:"font-bold",children:"Total items count:"}),e("span",{className:"italic",children:Y})]})]}),e(he,{page:l,pagesCount:W,onPageChange:K(l),disabled:ae}),r("div",{className:"flex gap-3 items-center justify-center flex-wrap max-h-[30rem] overflow-auto relative",children:[e("div",{className:"sticky top-0 left-0 right-0 h-5 w-full bg-gradient-to-b from-[var(--color-bg-app)] to-transparent"}),A.map((s,a)=>e("div",{className:"p-2 flex flex-col space-y-2 border rounded-md",children:s.map(({fieldId:d,fieldName:w,value:x,dataType:T})=>r("div",{className:"flex gap-3",children:[e("span",{className:"font-bold",children:`${w}:`}),e("span",{children:T==="date-time"?`${new Date(`${x}`).toISOString()}`:`${x}`}),e("span",{children:`( ${T} )`})]},d))},a)),e("div",{className:"sticky bottom-0 left-0 right-0 h-5 w-full bg-gradient-to-b from-transparent to-[var(--color-bg-app)]"})]})]}):null]})},Be=Ne;export{Ne as PublicGetLogicalDataExample,Be as default};
